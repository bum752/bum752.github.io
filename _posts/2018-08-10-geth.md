---
title: '[Ethereum] Geth ì‚¬ìš©í•´ë³´ê¸°'
time: 2018-08-10 13:08:00
categories: ethereum
---

ë¸”ë¡ì²´ì¸ í”Œë«í¼ ì¤‘ í•˜ë‚˜ì¸ Ethereumì„ ì„¤ì¹˜í•˜ê³  Private Networkë¥¼ êµ¬ì¶•í•´ë³´ì•˜ìŠµë‹ˆë‹¤.

`Ubuntu 18.04 LTS(ubuntu-18.04-desktop-amd64)`ì—ì„œ ì§„í–‰ë˜ì—ˆìŠµë‹ˆë‹¤.

## Geth ì„¤ì¹˜
`geth`ëŠ” ì´ë”ë¦¬ì›€ ë…¸ë“œ ì‹¤í–‰ì„ ìœ„í•œ CLI(Command Line Interface)ì…ë‹ˆë‹¤.

> golang

Goë¥¼ ì´ìš©í•´ ë¹Œë“œí•˜ê¸° ë•Œë¬¸ì— golangì„ ì„¤ì¹˜í•´ì•¼ í•©ë‹ˆë‹¤.
{% highlight bash %}
# íŒ¨í‚¤ì§€ë¥¼ ì´ìš©í•œ ì„¤ì¹˜
$ sudo apt-get install golang-go

# ë°”ì´ë„ˆë¦¬ë¥¼ ì´ìš©í•œ ì„¤ì¹˜
$ wget https://dl.google.com/go/go1.10.3.linux-amd64.tar.gz
$ tar zxvf go1.10.3.linux-amd64.tar.gz
$ cd go
$ export GOROOT=$(pwd)
$ export PATH=$PATH:$GOROOT/bin
$ go version
go version go1.10.3 linux/amd64
{% endhighlight %}

> Building geth

{% highlight bash %}
$ git clone https://github.com/ethereum/go-ethereum.git
$ cd go-ethereum
$ make
$ sudo cp build/bin/geth /usr/local/bin/
$ geth version
Geth
Version: 1.8.14-unstable
Git Commit: 45eaef24319897f5b1679c9d1aa7d88702cce905
Architecture: amd64
Protocol Versions: [63 62]
Network Id: 1
Go Version: go1.10.3
Operating System: linux
GOPATH=
GOROOT=/home/jbshin/ehtereum-workspace/go
{% endhighlight %}

## Private Network
ìœ„ì˜ ê³¼ì •ìœ¼ë¡œ gethê°€ ì„¤ì¹˜ë˜ê³  ì„¤ì¹˜ëœ gethë¥¼ ì´ìš©í•´ Private Networkë¥¼ êµ¬ì¶•í•´ë³´ê² ìŠµë‹ˆë‹¤.

ìš°ì„  í¸ì˜ë¥¼ ìœ„í•´ `privnet`ì´ë¼ëŠ” í´ë”ë¥¼ ë§Œë“¤ê²Œìš”.  
í¸í•˜ì‹  ê²½ë¡œì— í¸í•˜ì‹  í´ë”ëª…ìœ¼ë¡œ ì‘ëª…í•˜ì…”ë„ ë©ë‹ˆë‹¤!
{% highlight bash %}
$ mkdir -p ~/ethereum-workspace/privnet
$ cd ~/ethereum-workspace/privnet
{% endhighlight %}

> Genesis Block

ì œë„¤ì‹œìŠ¤ ë¸”ë¡ì„ ìƒì„±í•˜ê¸° ìœ„í•´ `genesis.json` íŒŒì¼ì„ ì‘ì„±í•©ë‹ˆë‹¤.  
í¸í•˜ì‹  ì—ë””í„°ë¥¼ ì´ìš©í•´ ì•„ë˜ì˜ ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.
{% highlight json %}
{
  "config": {
    "chainId": 2018,
    "homesteadBlock": 0,
    "eip155Block": 0,
    "eip158Block": 0
  },
  "nonce": "0x0000000000000033",
  "timestamp": "0x0",
  "parentHash": "0x0000000000000000000000000000000000000000000000000000000000000000",
  "gasLimit": "0x8000000",
  "difficulty": "0x100",
  "mixhash": "0x0000000000000000000000000000000000000000000000000000000000000000",
  "coinbase": "0x3333333333333333333333333333333333333333",
  "alloc": {}
}
{% endhighlight %}

> Initialize

{% highlight bash %}
$ geth --datadir ./data init genesis.json
{% endhighlight %}

> Node

ì œë„¤ì‹œìŠ¤ ë¸”ë¡ ìƒì„±ê¹Œì§€ í–ˆìœ¼ë‹ˆ ëª¨ë“  ì¤€ë¹„ê°€ ì™„ë£Œëœ ê²ƒ ê°™ë„¤ìš”.  
ì´ì œ ë…¸ë“œë¥¼ ì‹¤í–‰í•´ë³¼ê¹Œìš”?
{% highlight bash %}
$ geth --rpc --datadir ./data --nodiscover --rpcapi db,eth,net,web3,admin.personal console
{% endhighlight %}
RPC addressì™€ portëŠ” ê°ê° `--rpcaddr`, `--rpcport` ì˜µì…˜ì„ ì´ìš©í•´ ì§€ì •í•  ìˆ˜ ìˆìœ¼ë©° defaultë¡œ `127.0.0.1:8545`ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.  
`--networkid`ë¥¼ ì´ìš©í•´ ë„¤íŠ¸ì›Œí¬IDë¥¼ ì§€ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
`--nodiscover` ì˜µì…˜ì€ ê°™ì€ ì œë„¤ì‹œìŠ¤ ë¸”ë¡ê³¼ ë„¤íŠ¸ì›Œí¬IDì— ìˆëŠ” ë…¸ë“œë“¤ì´ ì—°ê²°í•˜ëŠ” ê²ƒì„ ë°©ì§€í•´ì¤ë‹ˆë‹¤.

## Geth ì‚¬ìš©í•˜ê¸°
gethë¡œ Private Networkì˜ ë…¸ë“œë¡œ ì°¸ì—¬í•˜ëŠ” ê²ƒì— ì„±ê³µí–ˆìŠµë‹ˆë‹¤!  
ê·¸ë ‡ë‹¤ë©´ accountë¥¼ ë§Œë“¤ê³  miningì„ í•˜ê³  ì†¡ê¸ˆí•˜ëŠ” ë“± ê°„ë‹¨í•œ ì‚¬ìš©ë²• ëª‡ê°€ì§€ë¥¼ ì•Œì•„ë³¼ê¹Œìš”?

account ëª©ë¡ì„ ì¡°íšŒí•´ë³¼ê²Œìš”.
{% highlight bash %}
> eth.accounts
[]
{% endhighlight %}
ëª…ë ¹ì–´ë¥¼ ì…ë ¥í•˜ë‹ˆ ë¹ˆ ë°°ì—´ì´ ë‚˜ì˜¤ë„¤ìš”.  
accountê°€ ì—†ìœ¼ë‹ˆ í•˜ë‚˜ ìƒˆë¡œ ë§Œë“¤ì–´ë³´ì£ .
{% highlight bash %}
> personal.newAccount('jb')
"0x260bf32fc4529a3167c73f02f06201c02f028205" # ì¶œë ¥ë˜ëŠ” ê°’ì´ ë‹¤ë¥¼ê±°ì—ìš”!
{% endhighlight %}
`personal.newAccount()`ì˜ íŒŒë¼ë¯¸í„°ì— passphraseê°€ ì…ë ¥ë©ë‹ˆë‹¤.  
`0x260bf32fc4529a3167c73f02f06201c02f028205`ì˜ passphraseëŠ” `jb`ì—ìš”.

{% highlight bash %}
> eth.accounts
["0x260bf32fc4529a3167c73f02f06201c02f028205"]
{% endhighlight %}
account ëª©ë¡ì— ì •ìƒì ìœ¼ë¡œ ì¶”ê°€ë˜ì—ˆë„¤ìš”.

ì´ accountì—ëŠ” ì–¼ë§ˆì˜ etherê°€ ìˆì„ê¹Œìš”?
{% highlight bash %}
> eth.getBalance(eth.accounts[0]) # eth.getBalance('0x260bf32fc4529a3167c73f02f06201c02f028205')
0
{% endhighlight %}
0ì´ë„¤ìš”... ë‹¹ì—°í•œê±°ê² ì£ ?

ë¸”ë¡ì„ ë§ˆì´ë‹í•˜ê³  ë³´ìƒì„ ë°›ëŠ” ê³¼ì •ì„ í•´ë³´ê² ìŠµë‹ˆë‹¤.
{% highlight bash %}
> miner.start()
INFO [08-10|17:35:09.128] Updated mining threads                   threads=0
INFO [08-10|17:35:09.128] Transaction pool price threshold updated price=18000000000
INFO [08-10|17:35:09.128] Etherbase automatically configured       address=0x260BF32FC4529a3167c73f02F06201C02F028205
null
INFO [08-10|17:35:09.128] Commit new empty mining work             number=1 uncles=0
INFO [08-10|17:35:09.128] Commit new full mining work              number=1 txs=0 uncles=0 elapsed=261.395Âµs
INFO [08-10|17:35:12.791] Generating DAG in progress               epoch=0 percentage=0 elapsed=2.844s
INFO [08-10|17:35:15.767] Generating DAG in progress               epoch=0 percentage=1 elapsed=5.819s
...
INFO [08-10|17:39:54.978] Successfully sealed new block            number=1 hash=5a2077â€¦0eb665
INFO [08-10|17:39:54.979] ğŸ”¨ mined potential block                  number=1 hash=5a2077â€¦0eb665
INFO [08-10|17:39:54.979] Commit new empty mining work             number=2 uncles=0
INFO [08-10|17:39:54.979] Commit new full mining work              number=2 txs=0 uncles=0 elapsed=316.197Âµs
{% endhighlight %}
ë§ˆì´ë‹ê¹Œì§€ì˜ ì‹œê°„ì´ ê½¤ ê±¸ë¦´ê±°ì—ìš”~  
ğŸ”¨ í‘œì‹œì™€ í•¨ê»˜ 1ë²ˆ ë¸”ë¡ì´ ë§ˆì´ë‹ë˜ì—ˆìŠµë‹ˆë‹¤!

(ì°¸ê³ ) accountê°€ ì—¬ëŸ¬ ê°œ ìˆëŠ”ë° ê·¸ ì¤‘ í•˜ë‚˜ë¥¼ ì§€ì •í•´ ë³´ìƒì„ ë°›ê³  ì‹¶ìœ¼ì‹œë‹¤ë©´ `miner.setEtherbase()`ë¥¼ í™œìš©í•´ë³´ì„¸ìš”!
{% highlight bash %}
> miner.setEtherbase(eth.accounts[1])
{% endhighlight %}

{% highlight bash %}
> eth.getBalance(eth.accounts[0])
5000000000000000000
{% endhighlight %}
5ether(5,000,000,000,000,000,000wei)ë¥¼ ë³´ìƒìœ¼ë¡œ ë°›ì€ ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ì´ë²ˆì—” ì†¡ê¸ˆì„ í•´ë´ì•¼ê² ì£ ?  
ì†¡ê¸ˆì„ ìœ„í•´ accountë¥¼ í•˜ë‚˜ ë” ìƒì„±í•©ì‹œë‹¤!  
{% highlight bash %}
> personal.newAccount('foo')
"0xc07f222c6312473fc5694fd2ae1cf1e78410b58c"
{% endhighlight %}

ì²˜ìŒ ë§Œë“¤ì—ˆë˜ accountì—ì„œ 1etherë¥¼ ìƒˆë¡œ ë§Œë“  accountë¡œ ì†¡ê¸ˆí•´ë³´ì£ !  
íŠ¸ëœì­ì…˜ì„ ë°œìƒí•˜ê¸° ìœ„í•´ì„œëŠ” account unlock ê³¼ì •ì´ í•„ìš”í•©ë‹ˆë‹¤.
{% highlight bash %}
> personal.unlockAccount(eth.accounts[0])
Unlock account 0x260bf32fc4529a3167c73f02f06201c02f028205
Passphrase:
true
> eth.sendTransaction({from: eth.accounts[0], to: eth.accounts[1], value: web3.toWei(1, 'ether')})
INFO [08-10|19:59:50.985] Submitted transaction                    fullhash=0x1a5fa277634a504a10ff4f33a6a29c208e90c113d54b40c5b4bcc99e84fd1a63 recipient=0xc07f222C6312473FC5694fD2ae1cf1E78410b58C
"0x1a5fa277634a504a10ff4f33a6a29c208e90c113d54b40c5b4bcc99e84fd1a63"
{% endhighlight %}
accountsì˜ 0ë²ˆ(jb)ì—ì„œ 1ë²ˆ(foo)ë¡œ 1etherë¥¼ ì†¡ê¸ˆí•˜ëŠ” íŠ¸ëœì­ì…˜ì´ ë°œìƒí•˜ì˜€ìŠµë‹ˆë‹¤.

ì´ íŠ¸ëœì­ì…˜ì˜ ì •ë³´ë¥¼ ë³¼ê¹Œìš”?  
`eth.pendingTransactions`ê³¼ `eth.getBlock('pending').transactions`ëŠ” í˜„ì¬ ë§ˆì´ë‹ ì¤‘ì¸ ë¸”ë¡ì— ìˆëŠ” íŠ¸ëœì­ì…˜ì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
{% highlight bash %}
> eth.pendingTransactions
[{
    blockHash: null,
    blockNumber: null,
    from: "0x260bf32fc4529a3167c73f02f06201c02f028205",
    gas: 90000,
    gasPrice: 18000000000,
    hash: "0x1a5fa277634a504a10ff4f33a6a29c208e90c113d54b40c5b4bcc99e84fd1a63",
    input: "0x",
    nonce: 0,
    r: "0xfee8ec5ab640f3a37c27b569966f9ec8a43199b2c8ef197ee49cf3cf67aa6df8",
    s: "0x6ca469673ec1e00d1e00d0954b0d8db49285b0dac418c8582d0dbb7b9237bad",
    to: "0xc07f222c6312473fc5694fd2ae1cf1e78410b58c",
    transactionIndex: 0,
    v: "0xfe8",
    value: 1000000000000000000
}]
> eth.getBlock('pending').transactions
["0x1a5fa277634a504a10ff4f33a6a29c208e90c113d54b40c5b4bcc99e84fd1a63"]
{% endhighlight %}

íŠ¸ëœì­ì…˜ì´ ë°œìƒë˜ê³  ë¸”ë¡ì´ ë§ˆì´ë‹ ëœ í›„ etherë¥¼ í™•ì¸í•´ë´…ë‹ˆë‹¤.
{% highlight bash %}
> eth.getBalance(eth.accounts[1])
1000000000000000000
{% endhighlight %}
1ether(1,000,000,000,000,000,000wei)ê°€ ì…ê¸ˆë˜ì—ˆìŠµë‹ˆë‹¤!

## Private Network
ë‹¤ì‹œ Private Networkì…ë‹ˆë‹¤.  
ì´ë¦„ì´ Networkì¸ë° ë…¸ë“œê°€ í•˜ë‚˜ë§Œ ìˆë‹¤ë©´ ì•„ì‰½ê² ì£ ?

ë…¸ë“œì˜ ì •ë³´ë¥¼ í™•ì¸í•´ë³¼ê²Œìš”.
{% highlight bash %}
> admin.nodeInfo
{
  enode: "enode://9bb90c172175f636faa6d1670607c88d23524080ee38f63a6d9347f5fa8d1e931a4a9e0423e7fab9f7816883d4a818474118aa41039e495f7f172d285d7a4df7@[::]:30303?discport=0",
  id: "9bb90c172175f636faa6d1670607c88d23524080ee38f63a6d9347f5fa8d1e931a4a9e0423e7fab9f7816883d4a818474118aa41039e495f7f172d285d7a4df7",
  ip: "::",
  listenAddr: "[::]:30303",
  name: "Geth/v1.8.14-unstable-45eaef24/linux-amd64/go1.10.3",
  ports: {
    discovery: 0,
    listener: 30303
  },
  protocols: {
    eth: {
      config: {
        chainId: 2018,
        eip150Hash: "0x0000000000000000000000000000000000000000000000000000000000000000",
        eip155Block: 0,
        eip158Block: 0,
        homesteadBlock: 0
      },
      difficulty: 918208,
      genesis: "0x5704d029fe80f4fb605c0cb5e31d591511f10a46a0cb8166f97d8d559f9bc5b0",
      head: "0xe74d827b527f35d9de71bd113ccdbc8498e36cedd9db9cb1b0ebc1c0390456b1",
      network: 1
    }
  }
}
{% endhighlight %}
ì´ ë°ì´í„°ì˜ `enode`ë¥¼ ì´ìš©í•´ ë‹¤ë¥¸ ë…¸ë“œì—ì„œ ì´ ë…¸ë“œë¥¼ ë„¤íŠ¸ì›Œí¬ì— ì¶”ê°€ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ê¸°ì¡´ ë…¸ë“œë¥¼ ì¢…ë£Œí•˜ê³  rpcaddrì„ ì§€ì •í•´ì„œ ë‹¤ì‹œ ì‹¤í–‰ì‹œì¼œë³¼ê²Œìš”.
{% highlight bash %}
> exit
$ geth --rpc --rpcaddr 0.0.0.0 --datadir ./data --nodiscover --rpcapi db,eth,net,web3,admin.personal console
{% endhighlight %}

ë‹¤ë¥¸ PCì—ì„œ ë…¸ë“œë¥¼ í•˜ë‚˜ ë” ì‹¤í–‰í•´ ì¤€ í›„ ì•„ë˜ì²˜ëŸ¼ nodeë¥¼ ì¶”ê°€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.  
{% highlight bash %}
# ìœ„ì™€ ë‹¤ë¥¸ PCì˜ ë…¸ë“œì…ë‹ˆë‹¤.
> admin.addPeer('enode://9bb90c172175f636faa6d1670607c88d23524080ee38f63a6d9347f5fa8d1e931a4a9e0423e7fab9f7816883d4a818474118aa41039e495f7f172d285d7a4df7@[::]:30303?discport=0')
true
> admin.peers
[{
    caps: ["eth/62", "eth/63"],
    id: "9bb90c172175f636faa6d1670607c88d23524080ee38f63a6d9347f5fa8d1e931a4a9e0423e7fab9f7816883d4a818474118aa41039e495f7f172d285d7a4df7",
    name: "Geth/v1.8.14-unstable-45eaef24/linux-amd64/go1.10.3",
    network: {
      inbound: false,
      localAddress: "[::1]:52530",
      remoteAddress: "[::1]:30303",
      static: true,
      trusted: false
    },
    protocols: {
      eth: {
        difficulty: 918208,
        head: "0xe74d827b527f35d9de71bd113ccdbc8498e36cedd9db9cb1b0ebc1c0390456b1",
        version: 63
      }
    }
}]
> INFO [08-10|20:23:19.741] Block synchronisation started
{% endhighlight %}

ë¸”ë¡ ë™ê¸°í™”ê°€ ì´ë£¨ì–´ì§€ê³  í”¼ì–´ê°€ 2ê°œì¸ PrivateNetworkê°€ ë§Œë“¤ì–´ì¡ŒìŠµë‹ˆë‹¤. ë” ì¶”ê°€ë„ ë˜ê² ì£ ?
